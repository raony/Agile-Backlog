{% load item_tags %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script type="text/javascript" src="{{ MEDIA_URL }}backlog/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}backlog/js/jquery-ui-1.7.2.custom.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}backlog/js/sprint.loader.js"></script>

<style type="text/css">
	body{font:normal 12px Verdana, Arial, Helvetica, sans-serif;color:#3a3a3a;}
	#backlogagile{width:70%;margin:0 auto;}
	.sortable { list-style-type: none; margin: 10px 0; padding: 0; position:relative; min-height: 10px;}
	.sortable li{ margin-bottom: 3px; padding: 10px; cursor: move;position:relative;}
	.sortable.odd li{background:#ebebeb;}
	.ui-state-highlight { height: 1.5em; line-height: 1.2em; }
	
	.ui-state-default, .ui-widget-content .ui-state-default { border: 1px solid #cbc7bd; background: #f8f7f6; }
	.ui-state-default a, .ui-state-default a:link, .ui-state-default a:visited { color: #4a5c65; outline: none; }
	.ui-state-highlight, .ui-widget-content .ui-state-highlight {background: #f7f3de;}
	
	.toggledescription{position:absolute;top:10px;right:10px;display:block;width:16px;height:16px;text-indent:-999em;background:url({{ MEDIA_URL }}backlog/css/agile-backlog/images/ui-icons_3572ac_256x240.png) -64px -192px no-repeat;}
	.toggledescription.toggleback{background-position:-96px -192px;}
	.complexity{position:absolute;right:60px;top:11px;margin:0;font-weight:700;}
	h2{margin:0;font-size:13px;}
	p{margin-bottom:0;}
	h1{font-size:16px;margin:16px 0 0 10px;}
</style>

<script type="text/javascript">

$(document).ready(function() {
	$(".sortable").sortable({
		axis: 'y',
		opacity: 0.7,
		connectWith: '.sortable',
		placeholder: 'ui-state-highlight',
	}).disableSelection();

	$(".description").hide();
	
	$(".toggledescription").click(function() {
		var o = $(this);
		$(this).parent().find(".description").toggle(0, function() {
			if ($(this).is(":visible")) {
				o.addClass("toggleback");
				o.find("span").text("Ocultar");
			} else {
				o.removeClass("toggleback");
				o.find("span").text("Exibir");
			}
		});
	});

	f_loader = new loader({{ project_id }});
});

$(window).scroll(function() {
	if (isBottom()) {
		alert("chegou no fim.");
	}
});

function isBottom() {
	var scr;
	var height = $(document).height() - $(window).height() - 50;

	if (navigator.appName == "Microsoft Internet Explorer") {
		scr = document.body.scrollTop;
	} else {
		scr = window.pageYOffset;
	}
	if (scr >= height) {
	    return true;
	}
}
</script>
</head>
<body>
<div id="backlogagile">
	{% for sprint in sprints %}
	<h1>{{ sprint }}</h1>
	<ul class="sortable odd" id="sprint_{{ sprint.id }}">
		{% for item in sprint.items.all %}
			<li class="ui-state-default" id="{{ item.id }}">{% item_show item %}</li>
		{% endfor %}
	</ul>
	<script type="text/javascript">
	$('#sprint_{{ sprint.id }}').bind('sortupdate', function(event, ui) {
		$.post("{% url sprint_view sprint.id %}", {'item[]': $(this).sortable('toArray')});
	});
	</script>
	{% endfor %}
</div>
</body>
</html>